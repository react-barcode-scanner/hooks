/*! For license information please see stories-hooks-barcode-CombinedHook-stories.d6e78d20.iframe.bundle.js.LICENSE.txt */
"use strict";(globalThis.webpackChunk_react_barcode_scanner_hooks=globalThis.webpackChunk_react_barcode_scanner_hooks||[]).push([[931],{"./node_modules/react/cjs/react-jsx-runtime.production.min.js":(__unused_webpack_module,exports,__webpack_require__)=>{var f=__webpack_require__("./node_modules/react/index.js"),k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};function q(c,a,g){var b,d={},e=null,h=null;for(b in void 0!==g&&(e=""+g),void 0!==a.key&&(e=""+a.key),void 0!==a.ref&&(h=a.ref),a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l,exports.jsx=q,exports.jsxs=q},"./node_modules/react/jsx-runtime.js":(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=__webpack_require__("./node_modules/react/cjs/react-jsx-runtime.production.min.js")},"./src/hooks/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{mv:()=>useBarcodeScanner,w6:()=>useGetDeviceList,F_:()=>useScanCanvas,pZ:()=>useVideoCanvas,vf:()=>useWebcam});var react=__webpack_require__("./node_modules/react/index.js");const useGetDeviceList=onDevices=>{const[deviceList,setDeviceList]=(0,react.useState)([]),[hasPermission,setHasPermission]=(0,react.useState)(!1);return(0,react.useEffect)(()=>{let active=!0;return listDevices().then(deviceList=>{active&&(setHasPermission(!(null==deviceList||!deviceList.length)),setDeviceList(deviceList),null==onDevices||onDevices(deviceList))}),()=>{active=!1}},[]),{deviceList,hasPermission}},listDevices=async()=>{try{var _navigator$mediaDevic,_devices$filter;const devices=await(null===(_navigator$mediaDevic=navigator.mediaDevices)||void 0===_navigator$mediaDevic?void 0:_navigator$mediaDevic.getUserMedia({video:{facingMode:"environment"}}).then(async()=>{var _navigator$mediaDevic2,_navigator$mediaDevic3;return await(null===(_navigator$mediaDevic2=navigator.mediaDevices)||void 0===_navigator$mediaDevic2||null===(_navigator$mediaDevic3=_navigator$mediaDevic2.enumerateDevices)||void 0===_navigator$mediaDevic3?void 0:_navigator$mediaDevic3.call(_navigator$mediaDevic2))}));return null!==(_devices$filter=null==devices?void 0:devices.filter(device=>"videoinput"===device.kind))&&void 0!==_devices$filter?_devices$filter:[]}catch(e){return e.toString().includes("videoinput failed")?window.alert("You may have more than one application or window using your camera."):console.log(e),[]}},getMediaConstraintsForDeviceChoiceOptions=(deviceList,deviceChoiceOptions)=>{const constraints={audio:!1,video:!0};if(0===deviceList.length)return;if(1===deviceList.length)return constraints;let advancedConstraints=[],{deviceId}=deviceChoiceOptions;const{matchers,facingMode,width,height}=deviceChoiceOptions;if(constraints.video={width,height},deviceId&&advancedConstraints.push({deviceId}),!deviceId&&null!=matchers&&matchers.length)for(const matcher of matchers){const matched=deviceList.filter(deviceInfo=>matcher.test(deviceInfo.label));if(1===matched.length){constraints.video.deviceId=matched[0].deviceId;break}if(matched.length>1){advancedConstraints=advancedConstraints.concat(matched.map(matchingDevice=>({deviceId:matchingDevice.deviceId})));break}}return deviceId||null!=matchers&&matchers.length||!facingMode||advancedConstraints.push({facingMode}),advancedConstraints.length>0&&(constraints.video={width,height,advanced:advancedConstraints}),constraints},getUserMedia=async(constraints,context="")=>await navigator.mediaDevices.getUserMedia(constraints),removeStreamTracks=stream=>{stream.getTracks().forEach(track=>{track.enabled=!1,track.stop(),stream.removeTrack(track)})};let barcodeDetector;const defaultBarcodeDetectorOptions={useNative:!1,formats:["ean_13","upc_a"]},getBarcodeDetector=async options=>{if(barcodeDetector)return barcodeDetector;return options.useNative&&"BarcodeDetector"in window||await __webpack_require__.e(631).then(__webpack_require__.bind(__webpack_require__,"./node_modules/@undecaf/barcode-detector-polyfill/dist/main.js")).then(BCD=>{const{BarcodeDetectorPolyfill}=BCD;window.BarcodeDetector=BarcodeDetectorPolyfill}),window.BarcodeDetector.getSupportedFormats().then(formats=>0===formats.length?Promise.reject("No barcode detection"):(barcodeDetector=new window.BarcodeDetector(options),Promise.resolve(barcodeDetector)))},useScanCanvas=options=>{const{hasPermission,onScan,barcodeDetectorOptions=defaultBarcodeDetectorOptions}=options,canvasRef=(0,react.useRef)(null),[canvas,setCanvas]=(0,react.useState)();(0,react.useEffect)(()=>{hasPermission&&canvasRef.current&&setCanvas(canvasRef.current)},[hasPermission]);const detectedBarcodesRef=(0,react.useRef)([]),[canDetect,setCanDetect]=(0,react.useState)(!0),onDraw=(0,react.useCallback)(async video=>{if(canvas&&canDetect)try{const barcodeDetector=await getBarcodeDetector(barcodeDetectorOptions);if(!canvas)return;const detectionSource=null!=video?video:await createImageBitmap(canvas),detectedBarcodes=detectedBarcodesRef.current;try{const barcodes=await(null==barcodeDetector?void 0:barcodeDetector.detect(detectionSource));barcodes.length>0&&barcodes.filter(code=>!detectedBarcodes.includes(code.rawValue)).length>0&&barcodes.forEach(barcode=>{detectedBarcodes.includes(barcode.rawValue)||(detectedBarcodes.push(barcode.rawValue),null==onScan||onScan(barcode.rawValue))})}catch(error){console.log("unable to detect",error)}finally{detectionSource instanceof ImageBitmap&&detectionSource.close()}}catch(error){console.error("setting can detect to false",error),setCanDetect(!1)}},[canvas]);return{onDraw,canDetect,canvas,canvasRef,detectedBarcodesRef}},playWithRetry=async videoElement=>{try{return videoElement.pause(),await videoElement.play()}catch(error){return console.log(error),new Promise(resolve=>{setTimeout(()=>resolve(playWithRetry(videoElement)),100)})}},useVideoCanvas=options=>{const{onDraw,onPlay,webcamVideo,trackSettings,shouldDraw=!0,canvas,hasPermission=!0,shouldPlay,timeoutDelay=17,zoom=1}=options,[context,setContext]=(0,react.useState)(),[hasListener,setHasListener]=(0,react.useState)(!1),[intervalIds,setIntervalIds]=(0,react.useState)([]);(0,react.useEffect)(()=>{setContext(null)},[zoom,null==webcamVideo?void 0:webcamVideo.width,null==webcamVideo?void 0:webcamVideo.height,null==canvas?void 0:canvas.width,null==canvas?void 0:canvas.height]),(0,react.useEffect)(()=>{if(!context&&canvas){setHasListener(!1);const canvasContext=null==canvas?void 0:canvas.getContext("2d",{willReadFrequently:!0});if(!canvasContext)return;return void setContext(canvasContext)}},[context,canvas]);const bounds=(0,react.useMemo)(()=>{var _trackSettings$width,_trackSettings$height;if(!(webcamVideo&&trackSettings&&canvas))return;const effectiveZoom=Math.pow(zoom,2),trackWidth=null!==(_trackSettings$width=trackSettings.width)&&void 0!==_trackSettings$width?_trackSettings$width:webcamVideo.width,trackHeight=null!==(_trackSettings$height=trackSettings.height)&&void 0!==_trackSettings$height?_trackSettings$height:webcamVideo.height,centerX=trackWidth/2,centerY=trackHeight/2;return[centerX-centerX/effectiveZoom,centerY-centerY/effectiveZoom,trackWidth/effectiveZoom,trackHeight/effectiveZoom,0,0,canvas.width,canvas.height]},[canvas,webcamVideo,trackSettings,zoom]),streamToCanvas=(0,react.useMemo)(()=>()=>{bounds&&context&&webcamVideo&&(context.drawImage(webcamVideo,...bounds),shouldDraw&&(null==onDraw||onDraw(webcamVideo)))},[bounds,onDraw,webcamVideo,shouldDraw,context]);(0,react.useEffect)(()=>{bounds&&hasPermission&&context&&webcamVideo&&!hasListener&&(webcamVideo.addEventListener("play",()=>{var intervalId;intervalIds.forEach(window.clearInterval),streamToCanvas(),intervalId=window.setInterval(streamToCanvas,timeoutDelay),setIntervalIds([...intervalIds,intervalId])},{once:!0}),shouldPlay&&playWithRetry(webcamVideo).then(onPlay),setHasListener(!0))},[bounds,canvas,webcamVideo,onPlay,shouldPlay,hasPermission,context])},defaultDeviceChoiceOptions={matchers:[/ultra/i,/back/i]},useWebcam=(options={})=>{const{deviceChoiceOptions,onDevices}=options,webcamVideoRef=(0,react.useRef)(null),[webcamVideo,setWebcamVideo]=(0,react.useState)(),{deviceList,hasPermission}=useGetDeviceList(onDevices);(0,react.useEffect)(()=>{hasPermission&&webcamVideoRef.current&&setWebcamVideo(webcamVideoRef.current)},[hasPermission,webcamVideoRef]);const combinedDeviceChoiceOptions=(0,react.useMemo)(()=>{var _webcamVideo$width,_webcamVideo$height;return Object.assign({width:null!==(_webcamVideo$width=null==webcamVideo?void 0:webcamVideo.width)&&void 0!==_webcamVideo$width?_webcamVideo$width:640,height:null!==(_webcamVideo$height=null==webcamVideo?void 0:webcamVideo.height)&&void 0!==_webcamVideo$height?_webcamVideo$height:480},null!=deviceChoiceOptions?deviceChoiceOptions:defaultDeviceChoiceOptions)},[hasPermission,webcamVideo,deviceChoiceOptions]),{stream,trackSettings}=((hasPermission,deviceList,deviceChoiceOptions)=>{const[stream,setStream]=(0,react.useState)(),[trackSettings,setTrackSettings]=(0,react.useState)(),setStreamAndSettings=stream=>{var _stream$getVideoTrack;setStream(stream),setTrackSettings(null===(_stream$getVideoTrack=stream.getVideoTracks())||void 0===_stream$getVideoTrack?void 0:_stream$getVideoTrack[0].getSettings())},constraints=(0,react.useMemo)(()=>getMediaConstraintsForDeviceChoiceOptions(deviceList,deviceChoiceOptions),[deviceList,deviceChoiceOptions]);return(0,react.useEffect)(()=>{let active=!0;return hasPermission&&constraints&&getUserMedia(constraints,"useDeviceStream #1").then(stream=>{active?setStreamAndSettings(stream):removeStreamTracks(stream)}).catch(error=>(console.log("requested device not available",constraints,error),getUserMedia({video:{facingMode:"environment"}},"useDeviceStream #2").then(setStreamAndSettings).catch(error=>(console.log("no environment-facing camera available",error),getUserMedia({video:!0},"useDeviceStream #3").then(setStreamAndSettings))))),()=>{active=!1}},[hasPermission,constraints]),{stream,trackSettings}})(hasPermission,deviceList,combinedDeviceChoiceOptions);return useStreamToVideoElement(webcamVideo,stream),{webcamVideo,webcamVideoRef,deviceList,hasPermission,stream,trackSettings}},useStreamToVideoElement=(videoElement,stream)=>{(0,react.useEffect)(()=>{videoElement&&stream&&(videoElement.srcObject=stream)},[stream,videoElement])},useBarcodeScanner=options=>{const{zoom=1,barcodeDetectorOptions,deviceChoiceOptions,onScan,onDevices,shouldPlay=!0}=options,{webcamVideo,webcamVideoRef,hasPermission,stream,trackSettings}=useWebcam({deviceChoiceOptions,onDevices}),{onDraw,canDetect,canvas,canvasRef,detectedBarcodesRef}=useScanCanvas({barcodeDetectorOptions,hasPermission,onScan});return useVideoCanvas({onDraw,webcamVideo,trackSettings,shouldDraw:canDetect,canvas,hasPermission,shouldPlay,zoom}),{webcamVideoRef,canvasRef,stream,detectedBarcodes:detectedBarcodesRef.current,hasPermission}}},"./src/stories/hooks/barcode/CombinedHook.css":()=>{},"./src/stories/hooks/barcode/CombinedHook.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Primary:()=>Primary,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),_hooks__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/hooks/index.ts"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__=(__webpack_require__("./src/stories/hooks/barcode/CombinedHook.css"),__webpack_require__("./node_modules/react/jsx-runtime.js"));const __WEBPACK_DEFAULT_EXPORT__={component:props=>{const{canvasWidth=640,canvasHeight=480,videoWidth=640,videoHeight=480,videoCropWidth=640,videoCropHeight=376,zoom=1}=props,[codes,setCodes]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]),[devices,setDevices]=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)([]),{webcamVideoRef,canvasRef,hasPermission}=(0,_hooks__WEBPACK_IMPORTED_MODULE_1__.mv)({zoom,onDevices:devices=>{setDevices(devices)},onScan:code=>{setCodes(codes.concat(code))}}),containerRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null);return(0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{var _containerRef$current,_containerRef$current2,_containerRef$current3,_containerRef$current4,_containerRef$current5,_containerRef$current6;null===(_containerRef$current=containerRef.current)||void 0===_containerRef$current||_containerRef$current.style.setProperty("--video-width",`${videoWidth}px`),null===(_containerRef$current2=containerRef.current)||void 0===_containerRef$current2||_containerRef$current2.style.setProperty("--video-height",`${videoHeight}px`),null===(_containerRef$current3=containerRef.current)||void 0===_containerRef$current3||_containerRef$current3.style.setProperty("--canvas-width",`${canvasWidth}px`),null===(_containerRef$current4=containerRef.current)||void 0===_containerRef$current4||_containerRef$current4.style.setProperty("--canvas-height",`${canvasHeight}px`),null===(_containerRef$current5=containerRef.current)||void 0===_containerRef$current5||_containerRef$current5.style.setProperty("--video-crop-width",`${videoCropWidth}px`),null===(_containerRef$current6=containerRef.current)||void 0===_containerRef$current6||_containerRef$current6.style.setProperty("--video-crop-height",`${videoCropHeight}px`)},[containerRef.current,videoWidth,videoHeight,canvasWidth,canvasHeight,videoCropWidth,videoCropHeight]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{children:[hasPermission?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsxs)("div",{ref:containerRef,className:"react-barcode-scanner-container",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("video",{ref:webcamVideoRef,width:videoWidth,height:videoHeight,playsInline:!0}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("canvas",{ref:canvasRef,width:canvasWidth,height:canvasHeight})]}):null,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("div",{className:"scanned-codes",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_3__.jsx)("textarea",{rows:10,cols:100,readOnly:!0,value:codes.join("\n")})})]})},title:"Scanner/Combined Hook"},Primary={args:{zoom:1,canvasWidth:480,canvasHeight:376,videoWidth:480,videoHeight:376,videoCropWidth:288,videoCropHeight:188}},__namedExportsOrder=["Primary"];Primary.parameters={...Primary.parameters,docs:{...Primary.parameters?.docs,source:{originalSource:"{\n  args: {\n    zoom: 1,\n    canvasWidth: 480,\n    canvasHeight: 376,\n    videoWidth: 480,\n    videoHeight: 376,\n    videoCropWidth: 288,\n    videoCropHeight: 188\n  }\n}",...Primary.parameters?.docs?.source}}}}}]);